#!/bin/bash
source "${KONIX_LIB_DIR}/lib_bash.sh"
findEmacsWindow () {
	wmctrl -l -x|grep -q '.Emacs'
}

findEmacsProcess () {
	if on_windows_p
	then
		ps -aW |grep -q 'emacs.exe'
	else
		ps -A -o comm|grep -q '^emacs$'
	fi
}

noNeedToCreateANewFrame ( ) {
	if konix_on_linux_p
	then
		if [ -n "$DISPLAY" ]
		then
			findEmacsWindow
		else
			return 0
		fi
	else
		if ! findEmacsProcess
		then
			source konix_assert.sh
		fi
	fi
}

printf "Starting an emacsclient " 1>&2
if noNeedToCreateANewFrame
then
	printf "with no frame\n" >&2
	if [ -z "$*" ]
	then
		# Need at least an argument when launching without -c
		set "."
	fi
	emacsclient -a "" "$@"
else
	printf "within a new frame\n" >&2
	emacsclient -a "" -c "$@"
fi
