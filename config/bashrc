#!/bin/bash

( [ -z "$PS1" ] || [ "${TERM}" == "dumb" ] || [ -n "$INEMACS" ]) && return
source "$KONIX_CONFIG_DIR/shrc"
source "$KONIX_LIB_DIR/soblib.sh"
# Use emacs key bindings
set -o emacs

# make less more friendly for non-text input files
LESSPIPE="$(which lesspipe)"
[ -e "$LESSFILE" -a -x "$LESSFILE" ] && eval "$(lesspipe)"

# If this is an xterm set the title to user@host:dir
case "$TERM" in
	xterm*|rxvt*)
		PROMPT_COMMAND='echo -ne "\033]0;${USER}@${HOSTNAME}: ${PWD/$HOME/~}\007"'
		;;
	*)
		;;
esac
# ################################################################################
# Others
# ################################################################################
# ************************************************************
# Bash Comp
# ************************************************************
if [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
fi

if [ -f /etc/profile.d/bash-completion.sh ]; then
    . /etc/profile.d/bash-completion.sh
fi

# source custom bash completions
OLD_IFS=$IFS
IFS=$'\n'
source "$KONIX_CONFIG_DIR/bash_completion"

# special case for notmuch completion
if [ -f "$KONIX_DEVEL_DIR/notmuch/completion/notmuch-completion.bash" ]
then
    source "$KONIX_DEVEL_DIR/notmuch/completion/notmuch-completion.bash"
fi

IFS=$OLD_IFS

# unset bash bmajor bminor

# do not generate a core dump by default to avoid dissemineting core dumps everywhere
# ulimit -c 209715200

# use the autocd feature to gain precious miliseconds
shopt -s autocd
# I like recursive globbing
shopt -s globstar
# ######################################################################
# For a nice git prompt
# ######################################################################
if [ -e "${KONIX_DEVEL_DIR}/sjoubert_dot_rc/.config/bash/git" ]
then
    source "${KONIX_DEVEL_DIR}/sjoubert_dot_rc/.config/bash/git"
    KONIX_GIT_PROMPT_SOURCED=1
fi

if which luarocks > /dev/null 2>&1
then
	eval `luarocks path`
fi

if which direnv > /dev/null 2>&1
then
    eval "$(direnv hook bash)"
fi

NIX_SETUP="${HOME}/.nix-profile/etc/profile.d/nix.sh"
if [ -e "${NIX_SETUP}" ]
then
    source "${NIX_SETUP}"
fi

if [ -e "$HOME/.cargo/env" ]
then
    source "$HOME/.cargo/env"
fi

[[ -s "${HOME}/.autojump/etc/profile.d/autojump.sh" ]] && source "${HOME}/.autojump/etc/profile.d/autojump.sh"
[[ -s "/usr/share/autojump/autojump.bash" ]] && source "/usr/share/autojump/autojump.bash"
if which starship > /dev/null
then
	eval "$(starship init bash)"
fi
